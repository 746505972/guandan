# ğŸ® æ¼è›‹å¼ºåŒ–å­¦ä¹  [åœ¨çº¿è¯•ç©](https://guandan.streamlit.app/)

![Static Badge](https://img.shields.io/badge/ver.-1.4.1-E85889)
![GitHub](https://img.shields.io/github/license/746505972/guandan?logo=github)

ä¸€ä¸ªåŸºäºå¼ºåŒ–å­¦ä¹ çš„æ¼è›‹ AI ç³»ç»Ÿï¼Œæ”¯æŒ Actor-Criticï¼ˆA2Cï¼‰ç½‘ç»œï¼Œå…·å¤‡è®­ç»ƒä¸æ¨ç†åŠŸèƒ½ï¼Œä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€ç©ºé—´ä¸å¥–åŠ±æœºåˆ¶ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/746505972/guandan.git
cd guandan
```

### 2. å®‰è£…ä¾èµ–

å»ºè®®ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼š

```bash
pip install -r requirements.txt
```

### 3. è¿è¡Œè®­ç»ƒ/è¯„ä¼°è„šæœ¬

```bash
python actor.py  # è®­ç»ƒä¸»å¾ªç¯
```

æˆ–æ‰“å¼€ Streamlit ç•Œé¢ï¼š

```bash
streamlit run app.py
```

æˆ–æ‰“å¼€Vueå‰ç«¯

1.start fastapi
```bash
uvicorn server.main:app --reload --port 8000
```

2.start Vue(dev)

>in cmd
```bash
cd guandan-frontend
npm run dev
```

è¯·åœ¨`guandan\guandan-frontend\src\utils\axios.ts`çš„ç¬¬ä¸‰è¡Œé…ç½®å¥½url

![alt text](<img_3.png>)
---

## ğŸ“Š é¡¹ç›®ç»“æ„ç®€è¦è¯´æ˜

- `actor.py`: è®­ç»ƒä¸»è„šæœ¬ï¼ŒåŒ…å« Actor/Critic ç½‘ç»œç»“æ„
- `app.py`: Streamlit å¯è§†åŒ–å‰ç«¯
- `FrontendGame.py`: Streamlit å¯è§†åŒ–åç«¯
- `display.py`: æ§åˆ¶å°å¯è§†åŒ–å‰åç«¯&èƒœç‡è®¡ç®—
- `give_cards.py`ã€`rule.py`: å·¥å…·å‡½æ•°ã€è§„åˆ™é€»è¾‘
- `doudizhu_actions.json`: ç»“æ„åŒ–åŠ¨ä½œç©ºé—´
- `setup.py`: Cythonç¼–è¯‘æ–‡ä»¶
- `model/`: å­˜æ”¾æ¨¡å‹ç»“æ„
- `server/`: æä¾›FastAPIåç«¯

---

## ğŸ‘‘èƒœç‡
### å•äººèƒœç‡ï¼Œå³1MLPä¸1éšæœºæœºå™¨äººç»„é˜Ÿ VS 2éšæœºæœºå™¨äºº
| Episode | èƒœç‡(%) | ç¬¬ä¸€æ‰‹å‡ºå®Œç‡(%) | ä¸€äºŒå(%) | ä¸€ä¸‰å(%) | ä¸€å››å(%) |
|---------|--------|---------------|----------|----------|----------|
| 400     | 52.50  | 25.50         | 39.05    | 39.05    | 21.90    |
| 600     | 46.00  | 24.50         | 42.39    | 34.78    | 22.83    |
| 800     | 60.50  | 36.00         | 36.36    | 39.67    | 23.97    |
| 1000    | 65.00  | 35.50         | 39.23    | 43.85    | 16.92    |
| 1200    | 55.00  | 31.50         | 32.73    | 45.45    | 21.82    |
| 1400    | 64.00  | 42.00         | 32.81    | 45.31    | 21.88    |
| 1600    | 63.00  | 47.50         | 35.71    | 45.24    | 19.05    |
| 1800    | 66.00  | 40.00         | 31.82    | 44.70    | 23.48    |
| 2000    | 64.00  | 46.00         | 32.81    | 46.09    | 21.09    |
| 2200    | 68.50  | 53.50         | 36.50    | 47.45    | 16.06    |
| 2400    | 58.50  | 33.50         | 37.61    | 37.61    | 24.79    |
| 2600    | 71.50  | 53.00         | 37.06    | 42.66    | 20.28    |
| 2800    | 68.00  | 50.00         | 38.97    | 41.91    | 19.12    |
| 3000    | 62.00  | 40.00         | 33.06    | 42.74    | 24.19    |

### å›¢é˜Ÿèƒœç‡ï¼Œå³2MLPç»„é˜Ÿ VS 2éšæœºæœºå™¨äºº
| Episode | èƒœç‡(%) | ä¸€äºŒå(%) | ä¸€ä¸‰å(%) | ä¸€å››å(%) |
|---------|--------|----------|----------|----------|
| 400     | 52.50  | 37.14    | 40.00    | 22.86    |
| 600     | 55.50  | 27.93    | 59.46    | 12.61    |
| 800     | 61.50  | 31.71    | 47.97    | 20.33    |
| 1000    | 61.00  | 47.54    | 37.70    | 14.75    |
| 1200    | 65.50  | 48.09    | 35.88    | 16.03    |
| 1400    | 66.00  | 52.27    | 30.30    | 17.42    |
| 1600    | 73.50  | 55.78    | 27.21    | 17.01    |
| 1800    | 74.50  | 46.98    | 38.26    | 14.77    |
| 2000    | 76.50  | 49.67    | 35.95    | 14.38    |
| 2200    | 81.50  | 57.67    | 26.99    | 15.34    |
| 2400    | 70.50  | 52.48    | 31.21    | 16.31    |
| 2600    | 80.00  | 61.88    | 26.25    | 11.88    |
| 2800    | 84.00  | 64.88    | 24.40    | 10.71    |
| 3000    | 79.00  | 55.06    | 25.95    | 18.99    |

![img.png](img.png)
![img_1.png](img_1.png)
**Transformerå•äººåŠå›¢é˜Ÿæµ‹è¯•èƒœç‡æŠ˜çº¿å›¾**
![img_2.png](img_2.png)
---
## ğŸ§  å¼ºåŒ–å­¦ä¹ è®¾è®¡è¯´æ˜

### âœ… A2C ç½‘ç»œç»“æ„ï¼ˆ2025/4/25ï¼‰

- **ActorNet**ï¼šè¾“å‡ºç»“æ„åŠ¨ä½œ `action_id` çš„æ¦‚ç‡åˆ†å¸ƒï¼ˆè€ƒè™‘äº†åˆæ³•æ€§ maskï¼‰ã€‚
- **CriticNet**ï¼šè¾“å‡ºå½“å‰çŠ¶æ€çš„ `value` ä¼°è®¡ã€‚

### ğŸ¯ å¥–åŠ±å‡½æ•°

```python
r = reward + gamma ** (len(memory) - i - 1) * final_reward
```

- `reward`ï¼šå³æ—¶å¥–åŠ± = å‡ºç‰Œé•¿åº¦ Ã— ç‰Œå‹çš„ `logic_point`
- `final_reward`ï¼šæ•´å±€å¥–åŠ±ã€‚é˜Ÿä¼è·èƒœæ—¶ï¼Œç­‰çº§ä¸ºï¼š12åâ†’3ï¼Œ13åâ†’2ï¼Œ14åâ†’1ï¼Œå¤±è´¥åˆ™ä¸ºç›¸åã€‚
- `memory`ï¼šè®°å½•æ•´å±€ä¿¡æ¯ï¼š
```python
  memory = [{state, action_id, reward}, ...]
 ```

### ğŸ§® ä¼˜åŠ¿å‡½æ•°ï¼ˆAdvantageï¼‰

$$
\text{advantage} = r + \gamma \cdot V(s') - V(s)
$$

> æœ€åä¸€ä¸ª `transition` æ—  `s'`ï¼Œè®¾ $\gamma \cdot V(s') = 0$

- **Actor Loss**: $-\log(p) \cdot \text{advantage}$
- **Critic Loss**: $\text{advantage}^2$

![graphviz.png](graphviz.png)
---

## ğŸ€„ çŠ¶æ€ç¼–ç ï¼ˆ2025/4/20ï¼‰

ä½¿ç”¨ One-Hot æˆ–å¤šçƒ­ç¼–ç ï¼Œæ„é€ çŠ¶æ€ç»´åº¦å¦‚ä¸‹ï¼š

| ç‰¹å¾             | ç»´åº¦            | æè¿°                               |
|------------------|------------------|------------------------------------|
| å½“å‰ç©å®¶çš„æ‰‹ç‰Œ     | 108              | ä¸¤å‰¯ç‰Œçš„ 54 å¼ ç‰Œçš„æ˜¯å¦åœ¨æ‰‹ä¿¡æ¯         |
| å…¶ä»–ç©å®¶æ‰‹ç‰Œæ•°é‡    | 3                | å‰©ä½™ç‰Œæ•°ï¼ˆå½’ä¸€åŒ–ï¼‰                     |
| æ¯ä¸ªç©å®¶æœ€è¿‘åŠ¨ä½œ    | 108 Ã— 4          | ä¸Šè½®æ¯ä½ç©å®¶çš„å‡ºç‰Œ                     |
| å‡ºè¿‡çš„ç‰Œ          | 108 Ã— 3          | è®°å½•å…¶ä»–ç©å®¶å·²ç»æ‰“å‡ºçš„ç‰Œ                |
| å½“å‰çº§ç‰Œ         | 13               | One-hot ç¼–ç                          |
| æœ€è¿‘ 20 æ¬¡åŠ¨ä½œ    | 108 Ã— 4 Ã— 5      | 5 è½®å†å²ï¼Œæ¯è½® 4 ç©å®¶ï¼Œæ¯äºº 108 ç»´       |
| åä½œçŠ¶æ€         | 3                | ä¸é˜Ÿå‹åä½œçš„ç¨‹åº¦                      |
| å‹åˆ¶çŠ¶æ€         | 3                | å¯¹æ•Œæ–¹çš„æ‰“å‡»ç¨‹åº¦                      |
| è¾…åŠ©çŠ¶æ€         | 3                | æ˜¯å¦æœ‰æ„é“ºè·¯ï¼ˆè¾…åŠ©é˜Ÿå‹ï¼‰               |
| **æ€»ç»´åº¦**        | `3049`           | å®Œæ•´è¾“å…¥ç»´åº¦                         |

### ğŸƒ ç¤ºä¾‹æ‰‹ç‰Œç¼–ç ï¼š

```python
hand = ['çº¢æ¡ƒ2', 'çº¢æ¡ƒ2','é»‘æ¡ƒ3', 'çº¢æ¡ƒ3', 'é»‘æ¡ƒ4', 'çº¢æ¡ƒ4', 'çº¢æ¡ƒ4', 'é»‘æ¡ƒ4',
        'é»‘æ¡ƒ5', 'çº¢æ¡ƒ5','å¤§ç‹','å°ç‹','å¤§ç‹']
```

å…¶ç¼–ç å¦‚ä¸‹ï¼š

```
[0. 1. 1. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 1. 1. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 1. 0. 1.]
```
>108ç»´å…·ä½“ä¸º{é»‘æ¡ƒã€çº¢æ¡ƒã€æ¢…èŠ±ã€æ–¹å—}ä¸{2ã€3ã€4ã€â€¦ã€Kã€A}ä½œç§¯ï¼Œç”Ÿæˆ52ç»´ã€‚å…·ä½“æ˜¯{é»‘æ¡ƒã€çº¢æ¡ƒã€æ¢…èŠ±ã€æ–¹å—}2ã€{é»‘æ¡ƒã€çº¢æ¡ƒã€æ¢…èŠ±ã€æ–¹å—}3ã€â€¦ï¼Œå¦‚æ­¤å†é‡å¤ä¸€éä¸º104ç»´ï¼Œå†åŠ ä¸Š{å°ç‹ã€å¤§ç‹ã€å°ç‹ã€å¤§ç‹}å¾—åˆ°æœ€ç»ˆ108ç»´ã€‚
---
## ğŸ“„ License

æœ¬é¡¹ç›®éµå¾ª [MIT License](https://github.com/746505972/guandan/blob/main/LICENSE)
